<!DOCTYPE HTML>
<html>
<head>
<meta charset="utf-8">
<title>jQuery File Upload Example</title>

<style>
.bar {
	max-width: 200px;
    height: 18px;
    background-color: green;
}
</style>
</head>
<body>

<%= form_for Photo.new, :controller => "photos", :action => "create" do |f| %>
  <%= f.label :image, "Upload paintings:" %>
  <%= file_field_tag :image, multiple: true %>
<% end %>

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script src="/assets/vendor/jquery.ui.widget.js"></script>
<script src="/assets/jquery.iframe-transport.js"></script>
<script src="/assets/jquery.fileupload.js"></script>
<script>
$(function () {
  $('#new_photo').fileupload({
    dataType: 'script',
      add: function (e, data) {
      	var imageData = []
      	var files = data.originalFiles;
        debugger
        data.context = $('<button/>').text('Upload').appendTo('#imageData ul li p').click(function () {
          data.context = $('<p/>').text('Uploading...').replaceAll($(this));
          $(data.context).append(progressBar);
          data.submit();
        });

      	for (var i = 0, f; f = files[i]; i++){
	      	imageData.push("<p>Name: " + f.name + ", Size: " + (f.size/1000).toFixed(0) + " kb</p>");
	      	}

	      var progressBar = '<div id="progress"><div class="bar" style="width: 0%;"></div></div>'

        $('#imageData').('<ul>' + '<li>' + imageData.join('') + '</li>' + '</ul>');

        data.context = $('<button/>').text('Upload')
          .appendTo(document.body)
          .click(function () {
            data.context = $('<p/>').text('Uploading...').replaceAll($(this));
            $(data.context).append(progressBar);
              data.submit();
            });
    	},

      done: function (e, data) {
        data.context.text('Upload finished.');
      },

      progress: function (e, data) {
        var progress = parseInt(data.loaded / data.total * 100, 10);
        console.log(data.loaded)
        console.log(data.total)
        console.log("PRogress")

        $('#progress .bar').css(
            'width',
            progress + '%'
        );
    	}
  });
});
</script>

<div id="imageData">
</div>
</body> 
</html>